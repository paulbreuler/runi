/**
 * Copyright (c) 2026 BaseState LLC
 * SPDX-License-Identifier: MIT
 *
 * runi Design System
 * Based on runi design tokens with Tailwind CSS utilities
 */

/* ============================================
   Color Scales (raw values)
   ============================================ */
@import './styles/color-scales.css';

/* ============================================
   Theme Token Mappings (:root / .light selectors)
   ============================================ */
@import './styles/theme-tokens.css';

/* ============================================
   Tailwind CSS
   ============================================ */
@import 'tailwindcss';
@import 'tw-animate-css';

/* ============================================
   Tailwind Theme Extensions
   ============================================ */
@theme {
  /* Typography */
  --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
  --font-mono: 'JetBrains Mono', ui-monospace, monospace;

  /* ============================================
     Semantic Color Tokens
     Uses --color-* prefix so Tailwind utilities work:
     - bg-bg-app, bg-bg-surface use --color-bg-*
     - text-text-primary, text-text-muted use --color-text-*
     - border-border-subtle use --color-border-*
     ============================================ */

  /* Background tokens (used as bg-bg-app, bg-bg-surface, etc.) */
  --color-bg-app: var(--color-background);
  --color-bg-surface: var(--color-surface);
  --color-bg-raised: var(--color-panel-solid);
  --color-bg-elevated: var(--gray-4);
  --color-bg-overlay: var(--color-overlay);

  /* Text tokens (used as text-text-primary, text-text-muted, etc.) */
  --color-text-primary: var(--gray-12);
  --color-text-secondary: var(--gray-11);
  --color-text-muted: var(--gray-9);
  --color-text-contrast: var(--gray-1);

  /* Border tokens (used as border-border-subtle, border-border-default, etc.) */
  --color-border-subtle: var(--gray-5);
  --color-border-default: var(--gray-6);
  --color-border-emphasis: var(--gray-7);

  /* Signal Colors (runi-specific, until full Radix scales added) */
  --color-signal-success: oklch(0.723 0.191 142.5);
  --color-signal-warning: oklch(0.769 0.188 70.08);
  --color-signal-error: oklch(0.637 0.237 25.33);
  --color-signal-ai: oklch(0.627 0.265 303.9);

  /* HTTP Method Colors */
  --color-method-get: var(--accent-9);
  --color-method-post: var(--color-signal-success);
  --color-method-put: var(--color-signal-warning);
  --color-method-patch: var(--color-signal-warning);
  --color-method-delete: var(--color-signal-error);
  --color-method-head: var(--gray-9);
  --color-method-options: var(--gray-9);

  /* Accent Colors (for Tailwind utility compatibility) */
  --color-accent-blue: var(--accent-9);
  --color-accent-blue-hover: var(--accent-10);
  --color-accent-contrast: var(--accent-contrast);
  --color-accent-purple: oklch(0.627 0.265 303.9);
  --color-accent-green: oklch(0.723 0.191 142.5);
  --color-accent-amber: oklch(0.769 0.188 70.08);
  --color-accent-red: oklch(0.637 0.237 25.33);

  /* ============================================
     Interactive State Tokens
     Usage: bg-pressed, border-pressed, text-pressed, etc.
     These tokens switch automatically based on .light class
     ============================================ */

  /* Pressed State (toggles, buttons when activated) */
  --color-pressed: var(--pressed-bg);
  --color-pressed-subtle: var(--pressed-bg-subtle);
  --color-pressed-border: var(--pressed-border);
  --color-pressed-text: var(--pressed-text);

  /* Selected State (multi-select, active tabs) */
  --color-selected: var(--selected-bg);
  --color-selected-solid: var(--selected-bg-solid);
  --color-selected-border: var(--selected-border);
  --color-selected-text: var(--selected-text);

  /* Active State (navigation, current item) */
  --color-active: var(--active-bg);
  --color-active-border: var(--active-border);
  --color-active-text: var(--active-text);
  --color-active-indicator: var(--active-indicator);

  /* Hover State */
  --color-hover: var(--hover-bg);
  --color-hover-accent: var(--hover-bg-accent);
  --color-hover-border: var(--hover-border);

  /* shadcn/ui compatibility layer */
  --color-foreground: var(--gray-12);
  --color-card: var(--color-surface);
  --color-card-foreground: var(--gray-12);
  --color-popover: var(--color-surface);
  --color-popover-foreground: var(--gray-12);
  --color-primary: var(--accent-9);
  --color-primary-foreground: var(--accent-contrast);
  --color-secondary: var(--color-panel-solid);
  --color-secondary-foreground: var(--gray-12);
  --color-muted: var(--color-panel-solid);
  --color-muted-foreground: var(--gray-11);
  --color-accent: var(--color-panel-solid);
  --color-accent-foreground: var(--gray-12);
  --color-destructive: var(--color-signal-error);
  --color-border: var(--gray-6);
  --color-input: var(--color-panel-solid);
  --color-ring: var(--color-primary);
}

/* ============================================
   Base Styles
   ============================================ */

html {
  scroll-behavior: smooth;
  /* Prevent elastic overscroll from moving the entire window */
  overscroll-behavior: none;
  width: 100%;
  height: 100%;
}

body {
  font-family: var(--font-sans);
  background-color: transparent;
  color: var(--color-text-primary);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  /* Prevent elastic overscroll from moving the entire window */
  overscroll-behavior: none;
  width: 100%;
  height: 100%;
}

#root {
  width: 100%;
  height: 100%;
  overflow: hidden;
  border-radius: 14px;
  background-color: var(--color-background);
}

@layer base {
  * {
    /* Focus indicator: use focusRingClasses on interactive elements; no global outline to avoid double indicators */
    @apply border-[color:var(--gray-6)];
  }

  /* Disable elastic overscroll bounce on all scrollable elements */
  *,
  *::before,
  *::after {
    overscroll-behavior: none;
  }

  /* Global Reduced Motion Reset */
  @media (prefers-reduced-motion: reduce) {
    *,
    ::before,
    ::after {
      animation-delay: -1ms !important;
      animation-duration: 1ms !important;
      animation-iteration-count: 1 !important;
      background-attachment: initial !important;
      scroll-behavior: auto !important;
      transition-duration: 0s !important;
      transition-delay: 0s !important;
    }
  }
}

@layer utilities {
  .window-blur {
    /* Dim root text tokens */
    --color-text-primary: var(--gray-10);
    --color-text-secondary: var(--gray-9);
    --color-text-muted: var(--gray-8);

    /* Dim root border tokens */
    --color-border-subtle: var(--gray-3);
    --color-border-default: var(--gray-4);

    /* Dim root background/surface tokens (propagates to bg-bg-app, bg-bg-surface, etc.) */
    --color-background: var(--gray-1);
    --color-surface: var(--gray-1);
    --color-panel-solid: var(--gray-2);
    --color-bg-elevated: var(--gray-3);

    /* Dim semantic/signal colors when blurred */
    --color-accent-blue: var(--gray-9);
    --color-accent-blue-hover: var(--gray-10);
    --color-accent-purple: var(--gray-9);
    --color-signal-success: var(--gray-9);
    --color-signal-warning: var(--gray-9);
    --color-signal-error: var(--gray-9);
    --color-signal-ai: var(--gray-9);

    /* Dim method colors specifically */
    --color-method-get: var(--gray-9);
    --color-method-post: var(--gray-9);
    --color-method-put: var(--gray-9);
    --color-method-patch: var(--gray-9);
    --color-method-delete: var(--gray-9);
  }
}

/* ============================================
   Animations
   ============================================ */

@keyframes pulse-glow {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.7;
    transform: scale(1.02);
  }
}

@keyframes slide-in {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes fade-up {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

.animate-slide-in {
  animation: slide-in 0.3s ease-out forwards;
}

.animate-fade-up {
  animation: fade-up 0.6s ease-out forwards;
}

/* ============================================
   Scrollbar Styling
   ============================================ */

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--color-surface);
}

::-webkit-scrollbar-thumb {
  background: var(--gray-8);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--gray-9);
}

/* Hide scrollbars while preserving scroll behavior */
.scrollbar-hidden {
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.scrollbar-hidden::-webkit-scrollbar {
  width: 0;
  height: 0;
}

/* ============================================
   Base UI ScrollArea Styling
   ============================================ */

/* Hide native scrollbar on viewport */
.scroll-area-viewport {
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.scroll-area-viewport::-webkit-scrollbar {
  display: none;
}

/* Scrollbar track */
.scroll-area-scrollbar {
  background: transparent;
  border-radius: 4px;
}

.scroll-area-scrollbar[data-orientation='vertical'] {
  width: 6px;
}

.scroll-area-scrollbar[data-orientation='horizontal'] {
  height: 6px;
}

/* Scrollbar thumb */
.scroll-area-thumb {
  background: var(--gray-8);
  border-radius: 4px;
  position: relative;
  opacity: 0;
  transition: opacity 0.2s;
}

.scroll-area-scrollbar[data-state='visible'] .scroll-area-thumb {
  opacity: 0.6;
}

.scroll-area-thumb:hover {
  background: var(--gray-9);
  opacity: 1 !important;
}

/* Ensure minimum touch target size (44x44px) */
.scroll-area-thumb::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;
  min-width: 44px;
  min-height: 44px;
}

/* Prevent scrollbar flashing during drag/resize operations */
/* Reserve space for scrollbars to prevent layout shifts */
[data-test-id='request-pane'],
[data-test-id='response-pane'],
[data-test-id='pane-container'] {
  scrollbar-gutter: stable;
  /* Use overlay scrollbars on macOS to prevent flashing */
  scrollbar-width: thin;
  /* Prevent layout thrashing during drag */
  contain: layout style;
}

/* Ensure scrollable content areas maintain stable scrollbars */
[data-test-id='request-pane'] > *,
[data-test-id='response-pane'] > * {
  scrollbar-gutter: stable;
}

/* Prevent scrollbar flashing during sidebar resize */
aside[data-test-id='sidebar'] {
  scrollbar-gutter: stable;
}

/* Prevent scrollbar flashing during drag/resize operations */
.scroll-container,
[data-test-id='request-pane'],
[data-test-id='response-pane'],
[data-test-id='pane-container'] {
  scrollbar-gutter: stable;
  /* Reserve space for scrollbar to prevent layout shifts */
}

/* Ensure scrollbars don't flash during layout animations */
[data-test-id='request-pane'] *,
[data-test-id='response-pane'] * {
  scrollbar-gutter: stable;
}

/* Prevent text color/rendering changes during resize */
/* This fixes subpixel rendering artifacts that can cause text color shifts */
[data-test-id='request-pane'],
[data-test-id='response-pane'] {
  /* Disable color transitions on text elements during resize */
  /* Only allow transitions on hover/focus, not during layout changes */
}

/* Ensure text elements don't transition color during layout changes */
[data-test-id='request-pane'] *,
[data-test-id='response-pane'] * {
  /* Text color transitions should only occur on hover/focus, not layout changes */
  /* This prevents color shifts during resize operations */
}

/* ============================================
   Selection
   ============================================ */

::selection {
  background: var(--accent-a5);
  color: var(--gray-12);
}

/* ============================================
   Code Snippet - Line Number Selection Prevention
   ============================================ */

.code-snippet-wrapper .token-line > span:first-child,
.code-snippet-wrapper span[class*='linenumber'] {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  pointer-events: none;
}

/* ============================================
   Code Snippet - Line Number Left Spacing
   ============================================ */

/* Remove left padding from container when it contains line numbers */
/* This overrides the px-2 padding on borderless variant */
/*
 * Note: !important is necessary here because we need to override Tailwind's utility classes
 * (px-2) when line numbers are present. The :has() selector provides specificity but
 * Tailwind's utility classes have high specificity, so !important is required to ensure
 * the override takes effect. This is a targeted override for a specific UI state.
 */
[data-language]:has(.code-snippet-wrapper .react-syntax-highlighter-line-number),
[data-language]:has(.code-snippet-wrapper span[class*='linenumber']) {
  padding-left: 0 !important;
}

/* Remove left padding from ResponseViewer body container when it contains line numbers */
[data-test-id='response-body']:has(.code-snippet-wrapper .react-syntax-highlighter-line-number),
[data-test-id='response-body']:has(.code-snippet-wrapper span[class*='linenumber']) {
  padding-left: 0 !important;
}

/* Remove left padding/margin from react-syntax-highlighter line number containers */
/* Target all possible structures: table-based and span-based line numbers */
.code-snippet-wrapper table[class*='react-syntax-highlighter'],
.code-snippet-wrapper table[class*='react-syntax-highlighter'] td:first-child,
.code-snippet-wrapper span[class*='react-syntax-highlighter-line-number'],
.code-snippet-wrapper span[class*='linenumber'],
.code-snippet-wrapper .react-syntax-highlighter-line-number,
/* Also apply to BodyEditor and other direct SyntaxHighlighter usage */
[data-test-id='body-syntax-layer'] table[class*='react-syntax-highlighter'],
[data-test-id='body-syntax-layer'] table[class*='react-syntax-highlighter'] td:first-child,
[data-test-id='body-syntax-layer'] span[class*='react-syntax-highlighter-line-number'],
[data-test-id='body-syntax-layer'] span[class*='linenumber'],
[data-test-id='body-syntax-layer'] .react-syntax-highlighter-line-number,
/* General selectors for any SyntaxHighlighter usage */
span[class*='react-syntax-highlighter-line-number'],
span[class*='linenumber'],
.react-syntax-highlighter-line-number {
  padding-left: 0 !important;
  margin-left: 0 !important;
}

/* Also target the pre/code containers that might have default padding */
.code-snippet-wrapper pre[class*='language-'],
.code-snippet-wrapper code[class*='language-'],
.code-snippet-wrapper div[class*='language-'],
[data-test-id='body-syntax-layer'] pre[class*='language-'],
[data-test-id='body-syntax-layer'] code[class*='language-'],
[data-test-id='body-syntax-layer'] div[class*='language-'] {
  padding-left: 0;
}
