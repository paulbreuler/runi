/**
 * Copyright (c) 2026 BaseState LLC
 * SPDX-License-Identifier: MIT
 *
 * runi Design System
 * Based on runi design tokens with Tailwind CSS utilities
 */

/* ============================================
   Color Scales (raw values)
   ============================================ */
@import './styles/color-scales.css';

/* ============================================
   Theme Token Mappings (:root / .light selectors)
   ============================================ */
@import './styles/theme-tokens.css';

/* ============================================
   Tailwind CSS
   ============================================ */
@import 'tailwindcss';
@import 'tw-animate-css';

/* ============================================
   Tailwind Theme Extensions
   ============================================ */
@theme {
  /* Typography */
  --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
  --font-mono: 'JetBrains Mono', ui-monospace, monospace;

  /* ============================================
     Zen "Ink" Surface Palette
     ============================================ */

  /* Background tokens - Lifted further for better visibility in bright environments */
  --color-bg-app: #141517;
  --color-bg-surface: #1c1d21;
  --color-bg-raised: #26272b;
  --color-bg-elevated: #2f3035;
  --color-bg-overlay: oklch(0.18 0.01 240 / 85%);

  /* Text tokens - Maximized contrast */
  --color-text-primary: oklch(1 0 240);
  --color-text-secondary: oklch(0.95 0.005 240);
  --color-text-muted: oklch(0.85 0.01 240);
  --color-text-contrast: oklch(0.05 0.01 240);

  /* Border tokens - High visibility for bright environments */
  --color-border-subtle: oklch(0.5 0.01 240 / 55%);
  --color-border-default: oklch(0.6 0.01 240 / 65%);
  --color-border-emphasis: oklch(0.75 0.01 240 / 75%);

  /* Focus ring token - Blue focus indicator */
  --color-ring: oklch(0.82 0.15 230);

  /* Signal Colors - High chroma and lightness to cut through glare */
  --color-signal-success: oklch(0.85 0.15 150);
  --color-signal-success-rgba-15: oklch(0.85 0.15 150 / 15%);
  --color-signal-warning: oklch(0.88 0.15 75);
  --color-signal-warning-rgba-15: oklch(0.88 0.15 75 / 15%);
  --color-signal-error: oklch(0.78 0.18 25);
  --color-signal-ai: oklch(0.8 0.15 300);
  --color-signal-ai-rgba-35: oklch(0.8 0.15 300 / 35%);
  --color-accent-blue: oklch(0.82 0.15 230);
  --color-accent-blue-hover: oklch(0.85 0.18 230);
  --color-accent-contrast: var(--color-text-primary);
  --color-accent-purple: var(--color-signal-ai);

  /* HTTP Method Colors - Zen Signal mapping */
  --color-method-get: oklch(0.7 0.1 230);
  --color-method-post: var(--color-signal-success);
  --color-method-put: var(--color-signal-warning);
  --color-method-patch: var(--color-signal-warning);
  --color-method-delete: var(--color-signal-error);
  --color-method-head: var(--color-text-muted);
  --color-method-options: var(--color-text-muted);

  /* Interactive State Tokens - Zen (No shadows, color shifts) */
  --color-pressed: var(--color-bg-raised);
  --color-pressed-subtle: oklch(0.2 0.01 240 / 20%);
  --color-pressed-border: var(--color-border-emphasis);
  --color-pressed-text: var(--color-text-primary);

  /* Selected State */
  --color-selected: oklch(0.7 0.1 230 / 15%);
  --color-selected-solid: var(--color-accent-blue);
  --color-selected-border: oklch(0.7 0.1 230 / 40%);
  --color-selected-text: var(--color-text-primary);

  /* Active State */
  --color-active: oklch(0.7 0.1 230 / 10%);
  --color-active-border: oklch(0.7 0.1 230 / 30%);
  --color-active-text: var(--color-text-primary);
  --color-active-indicator: var(--color-accent-blue);

  /* Hover State */
  --color-hover: var(--color-bg-raised);
  --color-hover-accent: oklch(0.7 0.1 230 / 10%);
  --color-hover-border: var(--color-border-emphasis);

  /* Transition Durations - Zen (0.2s - 0.4s) */
  --duration-zen-fast: 0.2s;
  --duration-zen-base: 0.3s;
  --duration-zen-slow: 0.4s;
}

/* ============================================
   Base Styles
   ============================================ */

html {
  scroll-behavior: smooth;
  /* Prevent elastic overscroll from moving the entire window */
  overscroll-behavior: none;
  width: 100%;
  height: 100%;
}

body {
  font-family: var(--font-sans);
  background-color: transparent;
  color: var(--color-text-primary);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  /* Prevent elastic overscroll from moving the entire window */
  overscroll-behavior: none;
  width: 100%;
  height: 100%;
}

#root {
  width: 100%;
  height: 100%;
  overflow: hidden;
  border-radius: 14px;
  background-color: var(--color-background);
}

@layer base {
  /* Suppress focus rings globally when using a mouse.
     Highlights should only appear during keyboard/voice navigation. */
  html[data-intent='mouse'] *:focus {
    outline: none !important;
    box-shadow: none !important;
  }

  * {
    /* Focus indicator: use focusRingClasses on interactive elements; no global outline to avoid double indicators */
    @apply border-border-subtle;
  }

  /* Disable elastic overscroll bounce on all scrollable elements */
  *,
  *::before,
  *::after {
    overscroll-behavior: none;
  }

  /* Global Reduced Motion Reset */
  @media (prefers-reduced-motion: reduce) {
    *,
    ::before,
    ::after {
      animation-delay: -1ms !important;
      animation-duration: 1ms !important;
      animation-iteration-count: 1 !important;
      background-attachment: initial !important;
      scroll-behavior: auto !important;
      transition-duration: 0s !important;
      transition-delay: 0s !important;
    }
  }
}

@layer utilities {
  /* Glass Utility */
  .glass {
    @apply bg-bg-surface/70 backdrop-blur-md border border-border-subtle/50;
  }

  /* Grain Utility */
  .grain {
    position: relative;
  }
  .grain::before {
    content: '';
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0.03;
    pointer-events: none;
    z-index: 10;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  }

  /* Drift Highlight Utility - For CodeMirror/Editor migration */
  .drift-highlight {
    background-color: var(--color-signal-warning-rgba-15);
    box-shadow: inset 2px 0 0 0 var(--color-signal-warning);
    position: relative;
  }

  /* Vigilance Monitor Progress Animation */
  .vigilance-progress {
    height: 2px;
    background: linear-gradient(
      to right,
      var(--color-signal-ai) 0%,
      var(--color-accent-blue) 50%,
      var(--color-signal-success) 100%
    );
    background-size: 200% 100%;
    animation: vigilance-flow 2s linear infinite;
  }

  /* Vigilance Monitor Idle State - Static line, same height as active to prevent layout shift */
  .vigilance-progress-idle {
    height: 2px;
    background: var(--color-border-subtle);
  }

  @keyframes vigilance-flow {
    0% {
      background-position: 100% 0%;
    }
    100% {
      background-position: -100% 0%;
    }
  }

  .window-blur {
    /* Dim root text tokens - Zen Inactive (Lifted for readability in glare) */
    --color-text-primary: oklch(0.75 0.01 240);
    --color-text-secondary: oklch(0.65 0.01 240);
    --color-text-muted: oklch(0.55 0.01 240);

    /* Dim root border tokens - Zen Inactive (High visibility maintained) */
    --color-border-subtle: oklch(0.35 0.01 240 / 30%);
    --color-border-default: oklch(0.4 0.01 240 / 35%);
    --color-border-emphasis: oklch(0.45 0.01 240 / 40%);

    /* Dim root background/surface tokens */
    --color-background: #0f1012;
    --color-surface: #141517;
    --color-panel-solid: #1a1b1e;
    --color-bg-elevated: #212225;

    /* Dim semantic/signal colors when blurred (Lifted chroma) */
    --color-signal-success: oklch(0.55 0.04 150);
    --color-signal-warning: oklch(0.55 0.04 75);
    --color-signal-error: oklch(0.55 0.04 25);
    --color-signal-ai: oklch(0.55 0.04 300);
    --color-accent-blue: oklch(0.55 0.04 230);

    /* Dim method colors specifically */
    --color-method-get: oklch(0.4 0.02 230);
    --color-method-post: oklch(0.4 0.02 150);
    --color-method-put: oklch(0.4 0.02 75);
    --color-method-patch: oklch(0.4 0.02 75);
    --color-method-delete: oklch(0.4 0.02 25);
  }
}

/* ============================================
   Animations - Deliberate and Calm
   ============================================ */

@keyframes pulse-glow {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.8;
    transform: scale(1.01);
  }
}

@keyframes slide-in {
  from {
    opacity: 0;
    transform: translateX(-4px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes fade-up {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-pulse-glow {
  animation: pulse-glow 3s linear infinite;
}

.animate-slide-in {
  animation: slide-in var(--duration-zen-base) linear forwards;
}

.animate-fade-up {
  animation: fade-up var(--duration-zen-slow) linear forwards;
}

/* ============================================
   Scrollbar Styling
   ============================================ */

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--color-bg-app);
}

::-webkit-scrollbar-thumb {
  background: var(--gray-7);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--gray-8);
}

/* Hide scrollbars while preserving scroll behavior */
.scrollbar-hidden {
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.scrollbar-hidden::-webkit-scrollbar {
  width: 0;
  height: 0;
}

/* ============================================
   Base UI ScrollArea Styling
   ============================================ */

/* Hide native scrollbar on viewport */
.scroll-area-viewport {
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.scroll-area-viewport::-webkit-scrollbar {
  display: none;
}

/* Scrollbar track */
.scroll-area-scrollbar {
  background: transparent;
  border-radius: 4px;
}

.scroll-area-scrollbar[data-orientation='vertical'] {
  width: 6px;
}

.scroll-area-scrollbar[data-orientation='horizontal'] {
  height: 6px;
}

/* Scrollbar thumb */
.scroll-area-thumb {
  background: var(--gray-7);
  border-radius: 4px;
  position: relative;
  transition: background 0.2s;
}

.scroll-area-thumb:hover {
  background: var(--gray-8);
}

/* Ensure minimum touch target size (44x44px) */
.scroll-area-thumb::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;
  min-width: 44px;
  min-height: 44px;
}

/* Prevent scrollbar flashing during drag/resize operations */
/* Reserve space for scrollbars to prevent layout shifts */
[data-test-id='request-pane'],
[data-test-id='response-pane'],
[data-test-id='pane-container'] {
  scrollbar-gutter: stable;
  /* Use overlay scrollbars on macOS to prevent flashing */
  scrollbar-width: thin;
  /* Prevent layout thrashing during drag */
  contain: layout style;
}

/* Ensure scrollable content areas maintain stable scrollbars */
[data-test-id='request-pane'] > *,
[data-test-id='response-pane'] > * {
  scrollbar-gutter: stable;
}

/* Prevent scrollbar flashing during sidebar resize */
aside[data-test-id='sidebar'] {
  scrollbar-gutter: stable;
}

/* Prevent scrollbar flashing during drag/resize operations */
.scroll-container,
[data-test-id='request-pane'],
[data-test-id='response-pane'],
[data-test-id='pane-container'] {
  scrollbar-gutter: stable;
  /* Reserve space for scrollbar to prevent layout shifts */
}

/* Ensure scrollbars don't flash during layout animations */
[data-test-id='request-pane'] *,
[data-test-id='response-pane'] * {
  scrollbar-gutter: stable;
}

/* Prevent text color/rendering changes during resize */
/* This fixes subpixel rendering artifacts that can cause text color shifts */
[data-test-id='request-pane'],
[data-test-id='response-pane'] {
  /* Disable color transitions on text elements during resize */
  /* Only allow transitions on hover/focus, not during layout changes */
}

/* Ensure text elements don't transition color during layout changes */
[data-test-id='request-pane'] *,
[data-test-id='response-pane'] * {
  /* Text color transitions should only occur on hover/focus, not layout changes */
  /* This prevents color shifts during resize operations */
}

/* ============================================
   Selection
   ============================================ */

::selection {
  background: var(--color-signal-ai-rgba-35);
  color: var(--color-text-primary);
}

/* ============================================
   Code Snippet - Line Number Selection Prevention
   ============================================ */

.code-snippet-wrapper .token-line > span:first-child,
.code-snippet-wrapper span[class*='linenumber'] {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  pointer-events: none;
}

/* ============================================
   Code Snippet - Line Number Left Spacing
   ============================================ */

/* Remove left padding from container when it contains line numbers */
/* This overrides the px-2 padding on borderless variant */
/*
 * Note: !important is necessary here because we need to override Tailwind's utility classes
 * (px-2) when line numbers are present. The :has() selector provides specificity but
 * Tailwind's utility classes have high specificity, so !important is required to ensure
 * the override takes effect. This is a targeted override for a specific UI state.
 */
[data-language]:has(.code-snippet-wrapper .react-syntax-highlighter-line-number),
[data-language]:has(.code-snippet-wrapper span[class*='linenumber']) {
  padding-left: 0 !important;
}

/* Remove left padding from ResponseViewer body container when it contains line numbers */
[data-test-id='response-body']:has(.code-snippet-wrapper .react-syntax-highlighter-line-number),
[data-test-id='response-body']:has(.code-snippet-wrapper span[class*='linenumber']) {
  padding-left: 0 !important;
}

/* Remove left padding/margin from react-syntax-highlighter line number containers */
/* Target all possible structures: table-based and span-based line numbers */
.code-snippet-wrapper table[class*='react-syntax-highlighter'],
.code-snippet-wrapper table[class*='react-syntax-highlighter'] td:first-child,
.code-snippet-wrapper span[class*='react-syntax-highlighter-line-number'],
.code-snippet-wrapper span[class*='linenumber'],
.code-snippet-wrapper .react-syntax-highlighter-line-number,
/* Also apply to BodyEditor and other direct SyntaxHighlighter usage */
[data-test-id='body-syntax-layer'] table[class*='react-syntax-highlighter'],
[data-test-id='body-syntax-layer'] table[class*='react-syntax-highlighter'] td:first-child,
[data-test-id='body-syntax-layer'] span[class*='react-syntax-highlighter-line-number'],
[data-test-id='body-syntax-layer'] span[class*='linenumber'],
[data-test-id='body-syntax-layer'] .react-syntax-highlighter-line-number,
/* General selectors for any SyntaxHighlighter usage */
span[class*='react-syntax-highlighter-line-number'],
span[class*='linenumber'],
.react-syntax-highlighter-line-number {
  padding-left: 0 !important;
  margin-left: 0 !important;
}

/* Also target the pre/code containers that might have default padding */
.code-snippet-wrapper pre[class*='language-'],
.code-snippet-wrapper code[class*='language-'],
.code-snippet-wrapper div[class*='language-'],
[data-test-id='body-syntax-layer'] pre[class*='language-'],
[data-test-id='body-syntax-layer'] code[class*='language-'],
[data-test-id='body-syntax-layer'] div[class*='language-'] {
  padding-left: 0;
}
